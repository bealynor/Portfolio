---
title: "Assesssment 1 - COVID-19 Impact on Digital Learning"
author: "Bea Lynor Barros "47758295""
date: "2023-09-05"
output:
  pdf_document: default
  word_document: default
editor_options:
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Data Cleaning and Wrangling  

**I. Installation of libraries
The following libraries are loaded for any necessary data manipulations and visualizations.

<br>

```{r, echo=TRUE}
library(tidyverse)
library(dplyr)
library(readr)
library(zoo)
```


<br>

**II. Combining District Engagegment files in one Engagement file

The code below lists and combines the "district_info" and engagement files per district in order to conduct Engagement Analysis of students. 

<br>

```{r, echo=TRUE}
# Identify and list all district csv files in folder using lapply
selected_files <- c("1000.csv", "1131.csv", "1052.csv", "1039.csv", "1044.csv")
data_list <- lapply(selected_files, read.csv)

#Loop through the file paths
for (selected_files in selected_files) {
  district_id <- sub("\\.csv$", "", selected_files)  # Extract district ID from file name
  data <- read.csv(selected_files)  # Read CSV file into a data frame

  # Add a new "district" column with the district ID
  data$district <- district_id
  
  # Assign data frame to a variable
  assign(paste("district_", district_id, "_data", sep = ""), data)
  
  # Store data frame in the list
  data_list[[district_id]] <- data
  
}

# Access and display data for each district
district_1000_data <- data_list[["1000"]]
district_1039_data <- data_list[["1039"]]
district_1044_data <- data_list[["1044"]]
district_1052_data <- data_list[["1052"]]
district_1131_data <- data_list[["1131"]]

combined_dataframe <- rbind(
  district_1000_data,
  district_1039_data,
  district_1044_data,
  district_1052_data,
  district_1131_data
)
print(combined_dataframe)

```
<br>

**III. Manipulating "districts_info

Some columns in the District_Info file have values in range. This needs to be changed to its mean in order to provide quantitative analysis regarding the target market profile. 

<br>
```{r, echo=TRUE}

# Read the 'districts_info.csv' file into a data frame
districts_info <- read_csv(file = "districts_info.csv")

# Display a summary of the 'districts_info' data frame
summary(districts_info)

# Show the first 6 entries of the 'districts_info' data frame
head(districts_info)

```
<br>

This code below changes the range values into mean of the following affected columns:
1. pct_black/hispanic
2. pct_free/reduced
3. pp_total_raw
4. county_connections_ratio

<br>
```{r, echo=TRUE}
# Columns to modify
columns_to_modify <- c(
  'pct_black/hispanic',
  'pct_free/reduced',
  'pp_total_raw',
  'county_connections_ratio'
)

for (column_name in columns_to_modify) {
  districts_info[[column_name]] <- gsub("\\[|\\]", "", districts_info[[column_name]])
  
  # Split the string into two numbers
  numeric_values <- as.numeric(unlist(strsplit(districts_info[[column_name]], ", ")))
  
  # Calculate the mean of the two numbers and round to 2 decimal places
  mean_value <- ifelse(all(is.na(numeric_values)), 0, sprintf("%.2f", mean(numeric_values, na.rm = TRUE)))
  
  # Update the column with the mean value
  districts_info[[column_name]] <- as.numeric(mean_value)  

  # Print the updated dataframe
  print(districts_info)
}

```
<br>

This code selects only the data with district IDs - 1000, 1039, 1044, 1052, 1131. We only need information from these five districts since these are the only data we have for Engagement Analysis. 

<br>
```{r, echo=TRUE}

# Values to select
selected_district_ids <- c(1000, 1039, 1044, 1052, 1131)

# Select rows with specific district_id values
selected_rows <- districts_info[districts_info$district_id %in% selected_district_ids, ]

# Display selected rows
print(selected_rows)
```

<br>
**III. Consolidating all dataframes into one single file

The code below merges all dataframes (engagement files, products info, and distric info)

<br>
```{r, echo=TRUE}
#read products_info file
products_info <- read.csv("products_info.csv")

# Merge the different dataframe with the combined_dataframe based on district_id
merged_engagement_district <- merge(combined_dataframe, selected_rows, by.x = "district", by.y = "district_id",all.x = TRUE)

# Merge the data based on the common "lp_id" column
consolidated_engagement_data <- merge(merged_engagement_district, products_info, by.x = "lp_id", by.y = "LP.ID", all.x = TRUE)

head(consolidated_engagement_data)
```
<br>

**IV. Cleaning of Values
The following actions were undertaken to clean the data:
1. Remove some missing Values
2. Remove selected columns
3. Change datatypes
4. Remove duplicates
5. Change mispelled values


A. Change date format
<br>
```{r, echo=TRUE}
#check for unique values in time column
unique(consolidated_engagement_data$time) 

#change character to date
consolidated_engagement_data$time <- as.Date(consolidated_engagement_data$time, format = "%d/%m/%Y")

#drop years not in 2020
dates_to_drop <- c("1/01/2022", "1/01/2044", "1/01/2050", "31/12/1020", "2/01/2050", "1/01/2033")

consolidated_engagement_data <- consolidated_engagement_data %>%
  filter(!time %in% as.Date(dates_to_drop, format = "%d/%m/%Y"))

#check updated dataframe
unique(consolidated_engagement_data$time) 
```
<br>

B. Change Engagement index NAs to 0. 
```{r, echo=TRUE}
#Change NAs to 0.00
consolidated_engagement_data$engagement_index <- ifelse(is.na(consolidated_engagement_data$engagement_index), 0, consolidated_engagement_data$engagement_index)

```
<br>

C. Cleaning State Column
<br>
```{r, echo=TRUE}
unique(consolidated_engagement_data$state)
```
```{r, echo=TRUE}
consolidated_engagement_data$state <- ifelse(consolidated_engagement_data$state == "NaN", "State 1131", consolidated_engagement_data$state)
consolidated_engagement_data$state <- ifelse(is.na(consolidated_engagement_data$state), "State 1039", consolidated_engagement_data$state)

```
<br>

D. Drop Other Columns
<br>
```{r, echo=TRUE}
consolidated_engagement_data <- consolidated_engagement_data[, !(names(consolidated_engagement_data) %in% c("URL", "locale", ""))]
head(consolidated_engagement_data)
```
<br>

E. Cleaning Sector Column
NEW

```{r, echo=TRUE}
# Show unique values in the "Sector(s)" column
unique(consolidated_engagement_data$Sector.s) 

# Replace specific values in the "Sector(s)" column
consolidated_engagement_data$Sector.s <- gsub("PreK-112", "PreK-12", consolidated_engagement_data$Sector.s)

consolidated_engagement_data$Sector.s <- gsub("PreK-122", "PreK-12", consolidated_engagement_data$Sector.s)

consolidated_engagement_data$Sector.s <- gsub("PreK-12; Higher; Corporate", "PreK-12; Higher Ed; Corporate", consolidated_engagement_data$Sector.s)

consolidated_engagement_data$Sector.s <- gsub("PPreK-12", "PreK-12", consolidated_engagement_data$Sector.s)

# Show the modified "Sector(s)" column
head(consolidated_engagement_data)

```
<br>

F. Drop NAs in other columns
<br>
```{r, echo=TRUE}

# Define a logical condition to check for NAs in specific columns
na_condition <- complete.cases(consolidated_engagement_data[, c("Sector.s.", "Provider.Company.Name", "Primary.Essential.Function")])

# Use the condition to subset your DataFrame
consolidated_engagement_data <- consolidated_engagement_data[na_condition, ]
head(consolidated_engagement_data)
```
<br>


\newpage






<!-- Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot. -->


